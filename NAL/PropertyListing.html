<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NAL India - Seller Property Management</title>
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
/>
<style>
  /* ===== Reset & Base ===== */
  * {
    box-sizing: border-box;
  }
  body,
  input,
  select,
  textarea,
  button {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }
  body {
    margin: 0;
    background: #f5f7f9;
    color: #333;
    min-height: 100vh;
    line-height: 1.5;
  }
  button {
    cursor: pointer;
    border: none;
  }
  input,
  select,
  textarea {
    border: 1px solid #d8e2ef;
    border-radius: 6px;
    padding: 8px 12px;
    font-size: 1rem;
    width: 100%;
  }
  input:focus,
  select:focus,
  textarea:focus {
    outline: none;
    border-color: #2c7be5;
    box-shadow: 0 0 5px #2c7be5aa;
  }
  label {
    font-weight: 600;
    margin-bottom: 6px;
    display: inline-block;
  }
  .small-label {
    font-weight: 400;
    font-size: 0.9rem;
    color: #6e84a3;
    margin-top: 2px;
  }
  .error-text {
    color: #b71c1c;
    font-size: 0.85rem;
    margin-top: 2px;
  }
  .success-text {
    color: #0f9d58;
    font-size: 0.9rem;
    margin-top: 4px;
  }
  .disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
  a {
    color: #2c7be5;
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }

  /* ===== Containers & Layout ===== */
  .container {
    display: flex;
    min-height: 100vh;
    background: #f5f7f9;
  }
  .sidebar {
    width: 260px;
    background: #fff;
    border-right: 1px solid #e1e5eb;
    padding: 20px 0;
    height: 100vh;
    position: fixed;
    overflow-y: auto;
    z-index: 1000;
  }
  .logo {
    display: flex;
    align-items: center;
    padding: 0 20px 20px;
    border-bottom: 1px solid #e1e5eb;
    margin-bottom: 20px;
    user-select: none;
  }
  .logo img {
    width: 36px;
    height: 36px;
    margin-right: 10px;
    background: #2c7be5;
    border-radius: 8px;
  }
  .logo-text {
    font-weight: 700;
    font-size: 20px;
    color: #2c7be5;
  }
  .logo-text span {
    font-size: 12px;
    color: #6e84a3;
    font-weight: 500;
    margin-left: 4px;
  }
  .menu-item {
    display: flex;
    align-items: center;
    padding: 12px 30px;
    color: #6e84a3;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.3s, color 0.3s;
    user-select: none;
  }
  .menu-item i {
    margin-right: 12px;
    font-size: 18px;
  }
  .menu-item.active,
  .menu-item:hover {
    background: #edf2f9;
    color: #2c7be5;
  }

  .main-content {
    flex: 1;
    margin-left: 260px;
    padding: 30px 30px 60px;
  }
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 1px solid #e1e5eb;
  }
  .page-title {
    font-size: 28px;
    font-weight: 700;
    color: #2c7be5;
  }
  .header-actions {
    display: flex;
    gap: 12px;
  }
  .btn {
    padding: 10px 16px;
    border-radius: 6px;
    font-weight: 600;
    font-size: 1rem;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
    user-select: none;
  }
  .btn-primary {
    background: #2c7be5;
    color: white;
  }
  .btn-primary:hover:not(.disabled) {
    background: #1a68d1;
  }
  .btn-outline {
    background: transparent;
    border: 1.5px solid #d8e2ef;
    color: #6e84a3;
  }
  .btn-outline:hover:not(.disabled) {
    background: #edf2f9;
  }

  .filter-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
    background: white;
    padding: 16px;
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
  }
  .search-box {
    display: flex;
    align-items: center;
    background: #f5f7f9;
    border-radius: 6px;
    padding: 8px 12px;
    width: 300px;
  }
  .search-box i {
    color: #6e84a3;
    margin-right: 8px;
  }
  .search-box input {
    background: transparent;
    border: none;
    font-size: 1rem;
    width: 100%;
    outline: none;
  }
  .filters {
    display: flex;
    gap: 12px;
  }
  .filter-select {
    padding: 8px 12px;
    border-radius: 6px;
    border: 1px solid #d8e2ef;
    background: white;
    color: #6e84a3;
    font-weight: 500;
    cursor: pointer;
    min-width: 140px;
  }

  /* Property Cards */
  .property-cards {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
  .property-card {
    background: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    display: flex;
    transition: transform 0.3s, box-shadow 0.3s;
  }
  .property-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
  }
  .property-image {
    width: 240px;
    flex-shrink: 0;
    position: relative;
  }
  .property-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .property-status {
    position: absolute;
    top: 12px;
    left: 12px;
    background: #2c7be5;
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
    user-select: none;
  }
  .property-content {
    flex: 1;
    padding: 20px;
    display: flex;
    flex-direction: column;
  }
  .property-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 12px;
  }
  .property-title {
    font-size: 18px;
    font-weight: 700;
    color: #2c7be5;
  }
  .property-actions {
    display: flex;
    gap: 8px;
  }
  .action-btn {
    width: 32px;
    height: 32px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f5f7f9;
    color: #6e84a3;
    cursor: pointer;
    transition: all 0.3s;
    user-select: none;
  }
  .action-btn:hover {
    background: #edf2f9;
    color: #2c7be5;
  }
  .property-address {
    color: #6e84a3;
    margin-bottom: 12px;
    font-size: 14px;
  }
  .property-details {
    display: flex;
    gap: 16px;
    margin-bottom: 16px;
    font-size: 14px;
    color: #6e84a3;
  }
  .property-features {
    display: flex;
    gap: 8px;
    margin-bottom: 16px;
    flex-wrap: wrap;
  }
  .feature-tag {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
    user-select: none;
    display: flex;
    align-items: center;
    gap: 4px;
  }
  .tag-sale {
    background: #d6e5fd;
    color: #2c7be5;
  }
  .tag-rent {
    background: #d5f0e6;
    color: #0f9d58;
  }
  .tag-urgent {
    background: #ffebe6;
    color: #f44336;
  }
  .tag-bidding {
    background: #fef7cd;
    color: #f4b400;
  }
  .tag-active {
    background: #d5f0e6;
    color: #0f9d58;
  }
  .tag-pending {
    background: #fef7cd;
    color: #f4b400;
  }
  .property-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: auto;
    font-weight: 600;
  }
  .property-price {
    font-size: 18px;
    color: #2c7be5;
  }
  .property-date {
    color: #6e84a3;
    font-size: 14px;
  }

  /* Sticky progress bar */
  #wizardProgress {
    position: sticky;
    top: 0;
    background: white;
    box-shadow: 0 2px 4px rgb(0 0 0 / 0.1);
    display: flex;
    justify-content: space-around;
    padding: 8px 0;
    font-weight: 600;
    font-size: 0.9rem;
    user-select: none;
    z-index: 1100;
  }
  #wizardProgress .step {
    flex: 1;
    text-align: center;
    padding: 8px 4px;
    cursor: pointer;
    color: #6e84a3;
    position: relative;
  }
  #wizardProgress .step.active {
    color: #2c7be5;
    font-weight: 700;
  }
  #wizardProgress .step.completed {
    color: #0f9d58;
  }
  #wizardProgress .step.completed::after {
    content: "✓";
    position: absolute;
    top: 4px;
    right: 15%;
    font-size: 1rem;
    color: #0f9d58;
  }

  /* Wizard modal overlay & container */
  #wizardModal {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.4);
    display: none;
    align-items: flex-start;
    justify-content: center;
    overflow-y: auto;
    z-index: 2000;
    padding: 40px 0;
  }
  #wizardContainer {
    background: white;
    border-radius: 12px;
    max-width: 720px;
    width: 100%;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    max-height: 90vh;
  }

  /* Wizard Header */
  #wizardHeader {
    padding: 18px 24px;
    background: #2c7be5;
    color: white;
    font-size: 1.25rem;
    font-weight: 700;
    user-select: none;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  #wizardCloseBtn {
    background: transparent;
    border: none;
    color: white;
    font-size: 1.6rem;
    line-height: 1;
    cursor: pointer;
  }

  /* Wizard Content */
  #wizardContent {
    padding: 24px 32px;
    overflow-y: auto;
    height: 480px;
  }
  #wizardContent form {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }
  #wizardContent fieldset {
    border: none;
    padding: 0;
  }
  #wizardContent legend {
    font-weight: 700;
    font-size: 1.1rem;
    margin-bottom: 12px;
  }

  /* Controls */
  #wizardControls {
    padding: 14px 32px;
    background: #f8fafd;
    border-top: 1px solid #d8e2ef;
    text-align: right;
  }
  #wizardControls button {
    margin-left: 12px;
    min-width: 120px;
  }

  /* Form group for inputs */
  .form-group {
    display: flex;
    flex-direction: column;
  }

  /* Inline tooltip icon */
  .tooltip-icon {
    font-size: 0.85rem;
    margin-left: 6px;
    color: #6e84a3;
    cursor: help;
  }
  .tooltip-text {
    visibility: hidden;
    background-color: #2c7be5;
    color: #fff;
    text-align: center;
    border-radius: 6px;
    padding: 6px 10px;
    position: absolute;
    z-index: 100;
    font-size: 0.8rem;
    white-space: nowrap;
    bottom: 125%;
    left: 50%;
    transform: translateX(-50%);
    opacity: 0;
    transition: opacity 0.3s;
  }
  .tooltip-icon:hover + .tooltip-text {
    visibility: visible;
    opacity: 1;
  }
  .relative {
    position: relative;
    display: inline-block;
  }

  /* Verified checkmark */
  .verified {
    color: #0f9d58;
    font-weight: 700;
    margin-left: 8px;
  }
  .spinner {
    display: inline-block;
    width: 18px;
    height: 18px;
    border: 2px solid #2c7be5;
    border-top: 2px solid transparent;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    vertical-align: middle;
    margin-left: 8px;
  }
  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }

  /* Autosave banner */
  #autosaveBanner {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #2c7be5;
    color: white;
    padding: 10px 16px;
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.9rem;
    box-shadow: 0 4px 12px rgb(44 123 229 / 0.7);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 2100;
  }
  #autosaveBanner.visible {
    opacity: 1;
    pointer-events: auto;
  }

  /* File upload styles */
  input[type='file'] {
    padding: 4px;
  }
  .file-note {
    font-size: 0.8rem;
    color: #6e84a3;
  }
  .file-list {
    margin-top: 6px;
    font-size: 0.9rem;
    color: #2c7be5;
  }
  .file-list span {
    display: inline-block;
    background: #d6e5fd;
    padding: 3px 8px;
    border-radius: 4px;
    margin-right: 5px;
    margin-bottom: 4px;
  }

  /* Spinner small inline for verify */
  .inline-spinner {
    border: 2px solid #2c7be5;
    border-top: 2px solid transparent;
    border-radius: 50%;
    width: 14px;
    height: 14px;
    animation: spin 0.8s linear infinite;
    display: inline-block;
    vertical-align: middle;
    margin-left: 6px;
  }

  /* Confirmation Success Banner within wizard */
  #stepSuccessBanner {
    background: #d5f0e6;
    color: #0f9d58;
    border: 1px solid #0f9d58;
    border-radius: 6px;
    padding: 12px 16px;
    margin-bottom: 20px;
    font-weight: 700;
    display: none;
  }

  /* Media thumbnails */
  .image-thumb {
    width: 100px;
    height: 70px;
    object-fit: cover;
    border-radius: 6px;
    margin-right: 12px;
    border: 2px solid transparent;
    cursor: pointer;
  }
  .image-thumb.cover {
    border-color: #2c7be5;
  }

  /* Checkbox group */
  .checkbox-group {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
  }
  .checkbox-group label {
    font-weight: normal;
    background: #e8f0fe;
    padding: 6px 12px;
    border-radius: 6px;
    cursor: pointer;
    user-select: none;
  }
  .checkbox-group input[type='checkbox'] {
    margin-right: 6px;
  }

  /* Hidden initially for conditional fields */
  .hidden {
    display: none;
  }

  /* Property dashboard empty state */
  #emptyState {
    text-align: center;
    margin-top: 80px;
    color: #6e84a3;
  }
  #emptyState h2 {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 12px;
    color: #2c7be5;
  }
  #emptyState p {
    font-size: 1.1rem;
    margin-bottom: 24px;
  }

  /* Bidding dashboard */
  #biddingDashboard {
    display: none;
    max-width: 1000px;
    margin: 20px auto 40px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.08);
    padding: 25px 35px 35px;
  }
  .ribbon {
    position: absolute;
    top: 20px;
    right: -35px;
    transform: rotate(45deg);
    background: #2c7be5;
    color: white;
    padding: 8px 40px;
    font-size: 0.9rem;
    font-weight: 600;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    user-select: none;
  }
  .ribbon.ended {
    background: #6c757d;
  }
  .property-summary {
    display: flex;
    gap: 25px;
    align-items: center;
    border-bottom: 1px solid #eaeef2;
    padding-bottom: 25px;
    margin-bottom: 25px;
    position: relative;
  }
  .property-summary img {
    width: 160px;
    height: 120px;
    object-fit: cover;
    border-radius: 10px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    transition: transform 0.3s ease;
  }
  .property-summary img:hover {
    transform: scale(1.03);
  }
  .property-info {
    flex: 1;
  }
  .property-name {
    font-size: 1.7rem;
    font-weight: 700;
    color: #2c7be5;
    margin-bottom: 8px;
  }
  .property-location {
    font-size: 1.05rem;
    color: #6e84a3;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .property-features {
    font-size: 0.95rem;
    color: #555;
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    align-items: center;
  }
  .property-status {
    display: inline-block;
    background: #2c7be5;
    color: white;
    padding: 5px 12px;
    font-size: 0.9rem;
    border-radius: 16px;
    font-weight: 600;
    user-select: none;
  }
  .feature-tag {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: #f3f7ff;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 0.9rem;
  }
  .timer-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-left: auto;
    min-width: 140px;
    user-select: none;
  }
  .timer-label {
    font-size: 0.9rem;
    color: #6e84a3;
    margin-bottom: 5px;
  }
  .timer {
    font-weight: 800;
    font-size: 1.5rem;
    color: #f44336;
    text-align: center;
    letter-spacing: 1px;
  }
  .timer-warning {
    font-size: 0.8rem;
    color: #f44336;
    margin-top: 5px;
    font-weight: 600;
    display: none;
  }
  .bids-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    gap: 12px;
  }
  .bids-title {
    font-size: 1.3rem;
    font-weight: 700;
    color: #2c7be5;
  }
  .bids-meta {
    color: #6e84a3;
    font-size: 0.95rem;
  }
  .sort-options {
    display: flex;
    gap: 10px;
    align-items: center;
  }
  .sort-label {
    font-size: 0.9rem;
    color: #6e84a3;
  }
  .sort-select {
    padding: 6px 10px;
    border-radius: 6px;
    border: 1px solid #ddd;
    background: white;
    font-size: 0.9rem;
    cursor: pointer;
  }
  .bids-wrapper {
    border: 1px solid #eaeef2;
    border-radius: 10px;
    background: #fafbfd;
    overflow: hidden;
  }
  .bids-section {
    max-height: 440px;
    overflow-y: auto;
    scroll-behavior: smooth;
  }
  .bids-section::-webkit-scrollbar {
    width: 8px;
  }
  .bids-section::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
  }
  .bids-section::-webkit-scrollbar-thumb {
    background: #c5cbd7;
    border-radius: 10px;
  }
  .bids-section::-webkit-scrollbar-thumb:hover {
    background: #a8b1c2;
  }
  .grid {
    display: grid;
    grid-template-columns: 64px 1.5fr 1fr 1fr 1.2fr 1fr;
    align-items: center;
    gap: 14px;
  }
  .bids-head {
    position: sticky;
    top: 0;
    z-index: 1;
    background: #f0f4fb;
    border-bottom: 1px solid #e1e7f0;
    padding: 10px 14px;
    font-weight: 700;
    color: #526581;
  }
  .bid-row {
    padding: 12px 14px;
    border-bottom: 1px solid #eee;
    background: #fff;
    transition: background 0.3s;
  }
  .bid-row:hover {
    background: #f7faff;
  }
  .bid-row.highlight {
    background: linear-gradient(135deg, #d6e5fd 0%, #e4ecff 100%);
    border-left: 4px solid #2c7be5;
  }
  .top-flag {
    text-align: center;
  }
  .top-flag i {
    color: #f4b400;
    font-size: 1.1rem;
  }
  .bidder-name {
    font-size: 1.05rem;
    color: #2c7be5;
    font-weight: 600;
  }
  .bidder-sub {
    font-size: 0.85rem;
    color: #6e84a3;
  }
  .deposit-amount {
    font-weight: 600;
    color: #444;
  }
  .bid-amount {
    font-weight: 800;
    color: #0f9d58;
  }
  .bid-timestamp {
    font-size: 0.92rem;
    color: #6e84a3;
  }
  .profile-button {
    background-color: #2c7be5;
    border: none;
    color: white;
    padding: 8px 14px;
    font-size: 0.9rem;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }
  .profile-button:hover {
    background-color: #1a68d1;
    transform: translateY(-1px);
  }
  .see-more-btn {
    background: transparent;
    border: 2px solid #2c7be5;
    color: #2c7be5;
    padding: 10px 18px;
    font-weight: 600;
    border-radius: 8px;
    cursor: pointer;
    margin: 16px auto;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .see-more-btn:hover {
    background: #e4ecff;
  }
  .see-more-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  .modal-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    display: none;
    align-items: center;
    justify-content: center;
    padding: 20px;
    z-index: 3000;
  }
  .modal {
    width: 100%;
    max-width: 520px;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    overflow: hidden;
  }
  .modal-header {
    padding: 16px 20px;
    background: #2c7be5;
    color: #fff;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .modal-body {
    padding: 18px 20px;
    display: grid;
    gap: 10px;
  }
  .close-btn {
    background: transparent;
    border: none;
    color: #fff;
    font-size: 1.2rem;
    cursor: pointer;
  }

  /* Toast */
  .toast {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #0f9d58;
    color: white;
    padding: 12px 18px;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
    display: flex;
    align-items: center;
    gap: 10px;
    transform: translateY(120%);
    opacity: 0;
    transition: all 0.4s ease;
    z-index: 3100;
  }
  .toast.show {
    transform: translateY(0);
    opacity: 1;
  }

  /* Bidding Over Overlay */
  .bidding-over-overlay {
    position: absolute;
    inset: 0;
    background: rgba(255, 255, 255, 0.98);
    display: none;
    justify-content: center;
    align-items: center;
    text-align: center;
    z-index: 100;
    flex-direction: column;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    animation: fadeIn 0.5s ease;
  }
  .bidding-over-message {
    max-width: 400px;
    padding: 25px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
  }
  .bidding-over-message h2 {
    color: #b71c1c;
    font-weight: 700;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
  }
  .bidding-over-message p {
    color: #555;
    font-size: 1rem;
    margin-bottom: 20px;
    line-height: 1.5;
  }
  .noted-btn {
    background: #2c7be5;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  .noted-btn:hover {
    background: #1a68d1;
    transform: translateY(-2px);
  }
  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  /* Responsive */
  @media (max-width: 960px) {
    .property-card {
      flex-direction: column;
    }
    .property-image {
      width: 100%;
      height: 200px;
    }
    .main-content {
      margin-left: 0;
      padding: 30px 20px 60px;
    }
    .sidebar {
      width: 60px;
      overflow-x: visible;
      padding: 10px 0;
    }
    .menu-item span,
    .logo-text {
      display: none;
    }
  }
</style>
</head>
<body>
<div class="container">
  <nav class="sidebar" role="navigation" aria-label="Main Sidebar Navigation">
    <div class="logo" aria-label="NAL India logo branding">
      <img
        src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0id2hpdGUiPjxwYXRoIGQ9Ik0xOSAxMGgtMXY5SDZ2LTlINVY1aDE0djV6bS04IDdoNHYtNWgtNHY1em05LTExSDR2MTNoMVY2aDE0djRoMXYtNHYtMnoiLz48L3N2Zz4="
        alt="NAL Logo"
        width="36"
        height="36"
      />
      <div class="logo-text">NAL <span>India</span></div>
    </div>
    <div
      class="menu-item active"
      tabindex="0"
      role="link"
      aria-current="page"
      aria-label="Dashboard"
      data-menu="dashboard"
    >
      <i class="fas fa-home"></i>
      <span>Dashboard</span>
    </div>
    <div
      class="menu-item"
      tabindex="0"
      role="link"
      aria-label="Manage Properties"
      data-menu="manage-properties"
    >
      <i class="fas fa-building"></i>
      <span>Manage Properties</span>
    </div>
    <div
      class="menu-item"
      tabindex="0"
      role="link"
      aria-label="Notifications"
      data-menu="notifications"
    >
      <i class="fas fa-bell"></i>
      <span>Notifications</span>
    </div>
    <div
      class="menu-item"
      tabindex="0"
      role="link"
      aria-label="Reports"
      data-menu="reports"
    >
      <i class="fas fa-chart-line"></i>
      <span>Reports</span>
    </div>
    <div
      class="menu-item"
      tabindex="0"
      role="link"
      aria-label="Settings"
      data-menu="settings"
    >
      <i class="fas fa-cog"></i>
      <span>Settings</span>
    </div>
    <div
      class="menu-item"
      tabindex="0"
      role="link"
      aria-label="Help & Support"
      data-menu="help-support"
    >
      <i class="fas fa-question-circle"></i>
      <span>Help & Support</span>
    </div>
  </nav>

  <main class="main-content" role="main" aria-label="Manage Properties Main Content">
    <header class="header">
      <h1 class="page-title">Manage Properties</h1>
      <div class="header-actions">
        <button type="button" class="btn btn-primary" id="btnAddProperty" aria-haspopup="dialog" aria-controls="wizardModal">
          <i class="fas fa-plus"></i> Add Property
        </button>
      </div>
    </header>

    <section id="propertyDashboard">
      <div id="emptyState" aria-live="polite">
        <h2>No properties listed yet.</h2>
        <p>Start by adding your first property.</p>
      </div>

      <div class="filter-bar" style="display:none;">
        <div class="search-box">
          <i class="fas fa-search"></i>
          <input type="search" id="searchProperties" placeholder="Search properties..." aria-label="Search properties" />
        </div>
        <div class="filters">
          <select id="filterStatus" class="filter-select" aria-label="Filter by status">
            <option value="all">All Statuses</option>
            <option value="Active">Active</option>
            <option value="Pending">Pending</option>
            <option value="Sold">Sold</option>
          </select>
          <select id="filterType" class="filter-select" aria-label="Filter by type">
            <option value="all">All Types</option>
            <option value="Sale">For Sale</option>
            <option value="Rent">For Rent</option>
            <option value="Urgent">Urgent Sale</option>
          </select>
          <select id="sortProperties" class="filter-select" aria-label="Sort properties">
            <option value="newest">Newest First</option>
            <option value="price-asc">Price: Low to High</option>
            <option value="price-desc">Price: High to Low</option>
            <option value="oldest">Oldest First</option>
          </select>
        </div>
      </div>

      <div class="property-cards" id="propertyCards"></div>
    </section>

    <!-- Wizard Modal -->
    <section id="wizardModal" role="dialog" aria-modal="true" aria-labelledby="wizardHeader" tabindex="-1">
      <div id="wizardContainer">
        <header id="wizardHeader">
          Create Property Listing
          <button id="wizardCloseBtn" aria-label="Close wizard">&times;</button>
        </header>
        <nav id="wizardProgress" aria-label="Listing creation progress">
          <div class="step active" data-step="0" tabindex="0" aria-current="step">Seller</div>
          <div class="step" data-step="1" tabindex="0">Ownership</div>
          <div class="step" data-step="2" tabindex="0">Intent</div>
          <div class="step" data-step="3" tabindex="0">Type</div>
          <div class="step" data-step="4" tabindex="0">Details</div>
          <div class="step" data-step="5" tabindex="0">Media</div>
          <div class="step" data-step="6" tabindex="0">Declaration</div>
          <div class="step" data-step="7" tabindex="0">Publish</div>
        </nav>
        <section id="wizardContent" tabindex="0">
          <!-- Steps Injected Here -->
        </section>
        <section id="stepSuccessBanner"></section>
        <section id="wizardControls">
          <button type="button" id="btnBack" class="btn btn-outline" disabled>Back</button>
          <button type="button" id="btnSaveDraft" class="btn btn-outline">Save Draft</button>
          <button type="button" id="btnNext" class="btn btn-primary" disabled>Next</button>
        </section>
      </div>
    </section>

    <!-- Autosave Banner -->
    <div id="autosaveBanner" role="alert" aria-live="polite" aria-atomic="true"></div>
  </main>
</div>

<!-- Bidding Dashboard -->
<section id="biddingDashboard" aria-label="Seller bidding dashboard">
  <div class="ribbon" id="biddingRibbon">LIVE BIDDING</div>
  <div class="property-summary" aria-label="Property details and auction timer">
    <img id="biddingPropertyImage" src="" alt="Property Thumbnail" />
    <div class="property-info">
      <div id="biddingPropertyName" class="property-name"></div>
      <div id="biddingPropertyLocation" class="property-location"><i class="fas fa-map-marker-alt" aria-hidden="true"></i> </div>
      <div class="property-features">
        <span id="biddingStatus" class="property-status">For Sale</span>
        <span id="biddingBeds" class="feature-tag"></span>
        <span id="biddingBaths" class="feature-tag"></span>
        <span id="biddingArea" class="feature-tag"></span>
      </div>
    </div>
    <div class="timer-container">
      <div class="timer-label">Time Remaining</div>
      <div
        class="timer pulse"
        role="timer"
        aria-live="polite"
        aria-atomic="true"
        aria-label="Time remaining for bidding"
        id="timerElement"
      >
        00:00:10
      </div>
      <div class="timer-warning" id="timerWarning">Bidding ends soon!</div>
    </div>
  </div>

  <div class="bids-header">
    <div>
      <div class="bids-title">
        Current Bids <span id="bidCount">(0)</span>
      </div>
      <div class="bids-meta">
        Highest Bid: <strong id="highestBidMeta">—</strong>
      </div>
    </div>
    <div class="sort-options">
      <span class="sort-label">Sort by:</span>
      <select class="sort-select" id="sortSelect" aria-label="Sort bids">
        <option value="amount-desc">Highest Amount First</option>
        <option value="amount-asc">Lowest Amount First</option>
        <option value="date-desc">Newest First</option>
        <option value="date-asc">Oldest First</option>
        <option value="deposit-desc">Highest Deposit</option>
        <option value="deposit-asc">Lowest Deposit</option>
      </select>
    </div>
  </div>

  <div class="bids-wrapper" role="region" aria-live="polite" aria-atomic="true">
    <div class="bids-section" id="bidsSection" tabindex="0" aria-label="List of bids" role="list">
      <!-- Bids injected here -->
    </div>
  </div>

  <button class="see-more-btn" id="seeMoreBtn" aria-label="Load more bids">
    <i class="fas fa-chevron-down"></i> Show More Bids
  </button>

  <div class="bidding-over-overlay" id="biddingOverOverlay" role="alertdialog" aria-modal="true" aria-hidden="true">
    <div class="bidding-over-message">
      <h2><i class="fas fa-gavel" aria-hidden="true"></i> Bidding Closed</h2>
      <p>The bidding for this property has ended. You can review all submitted bids below.</p>
      <button class="noted-btn" id="notedBtn" aria-label="Acknowledge bidding closed">
        <i class="fas fa-check"></i> Noted
      </button>
    </div>
  </div>
</section>

<!-- Profile Modal -->
<div class="modal-backdrop" id="profileModal" role="dialog" aria-modal="true" aria-labelledby="profileTitle" tabindex="-1">
  <div class="modal">
    <header class="modal-header">
      <h3 id="profileTitle" style="margin:0; font-size:1.1rem;">Bidder Profile</h3>
      <button class="close-btn" id="closeModal" aria-label="Close profile">
        <i class="fas fa-times"></i>
      </button>
    </header>
    <div class="modal-body" id="profileBody"></div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast" role="alert" aria-live="assertive">
  <i class="fas fa-check-circle" aria-hidden="true"></i><span id="toastMessage">Done</span>
</div>

<script>
  (() => {
    // --- DATA & STATE ---

    let properties = [];
    let editingPropertyId = null;
    let currentStep = 0;
    let isVerifying = false;
    let autosaveTimer = null;
    let autosaveTimeout = null;

    // Sample bids (for bidding dashboard)
    const sampleBidsTemplate = [
      { bidderId: 1, bidderName: 'Alice Kumar', deposit: 200000, amount: 7250000, timestamp: '2025-08-22T10:30:00', email: 'alice@example.com', profile: '#' },
      { bidderId: 2, bidderName: 'Bob Singh', deposit: 150000, amount: 7100000, timestamp: '2025-08-22T09:45:00', email: 'bob@example.com', profile: '#' },
      { bidderId: 3, bidderName: 'Charlie Rao', deposit: 150000, amount: 7000000, timestamp: '2025-08-21T15:20:00', email: 'charlie@example.com', profile: '#' },
    ];

    // --- UTILS ---
    function showToast(message) {
      const toast = document.getElementById('toast');
      const toastMsg = document.getElementById('toastMessage');
      toastMsg.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    function formatCurrency(num) {
      return new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 }).format(num);
    }
    function formatTimestamp(ts) {
      const d = new Date(ts);
      return d.toLocaleString('en-IN', { dateStyle: 'medium', timeStyle: 'short' });
    }
    function debounce(func, wait) {
      let timeout;
      return (...args) => {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
      };
    }
    function parseDateToYYYYMMDD(date) {
      const dt = new Date(date);
      const year = dt.getFullYear();
      const month = String(dt.getMonth() + 1).padStart(2, '0');
      const day = String(dt.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    // --- WIZARD PROGRESS & STEP MANAGEMENT ---

    const steps = [
      'Seller Registration',
      'Ownership Verification',
      'Listing Intent',
      'Property Type',
      'General Details',
      'Media & Highlights',
      'Declaration',
      'Publish Listing',
    ];

    const wizardModal = document.getElementById('wizardModal');
    const wizardContent = document.getElementById('wizardContent');
    const wizardProgress = document.getElementById('wizardProgress');
    const stepSuccessBanner = document.getElementById('stepSuccessBanner');

    function updateProgressBar() {
      const stepsElements = [...wizardProgress.children];
      stepsElements.forEach((el, idx) => {
        el.classList.remove('active', 'completed');
        if (idx < currentStep) el.classList.add('completed');
        else if (idx === currentStep) el.classList.add('active');
      });
    }

    function navigateToStep(stepIdx) {
      if (stepIdx < 0 || stepIdx > steps.length - 1) return;
      currentStep = stepIdx;
      stepSuccessBanner.style.display = 'none';
      clearTimeout(autosaveTimeout);
      updateProgressBar();
      renderStep(currentStep);
      updateControlButtons();
      focusFirstInputInStep();
    }

    // --- AUTOSAVE AND DRAFT BANNER ---

    const autosaveBanner = document.getElementById('autosaveBanner');

    function showAutosaveBanner() {
      const now = new Date();
      const timeStr = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      autosaveBanner.textContent = `Draft saved at ${timeStr}`;
      autosaveBanner.classList.add('visible');
      clearTimeout(autosaveTimer);
      autosaveTimer = setTimeout(() => autosaveBanner.classList.remove('visible'), 2500);
    }

    function autosaveDraft() {
      // Save all current inputs (simulate)
      if (editingPropertyId === null) {
        editingPropertyId = 'draft-' + Date.now();
      }
      // Here, for demo, just show banner
      // In real app, would sync with server here
      showAutosaveBanner();
    }

    const debouncedAutosave = debounce(autosaveDraft, 1000);

    function setupAutosaveForStep() {
      const inputs = wizardContent.querySelectorAll('input, select, textarea');
      inputs.forEach((input) => {
        input.addEventListener('input', () => {
          debouncedAutosave();
        });
      });
    }

    // --- VALIDATION HELPERS ---

    // Regex patterns for govt ID based on type
    const govtIdPatterns = {
      Aadhaar: /^\d{12}$/,
      PAN: /^[A-Z]{5}[0-9]{4}[A-Z]$/,
      Passport: /^[A-PR-WYa-pr-wy][1-9]\d\s?\d{4}[1-9]$/,
      'Voter ID': /^[A-Z]{3}[0-9]{7}$/,
    };

    // Sample roles
    const roles = ['Owner', 'Agent', 'Builder', 'Company'];

    // Validation Results = { valid: bool, errors: { field: message } }
    function validateSellerStep(data) {
      const errors = {};
      if (!data.fullName || !/^[a-zA-Z\s]+$/.test(data.fullName.trim())) {
        errors.fullName = 'Please enter your legal name as per your ID.';
      }
      if (!data.mobile || !/^\d{10}$/.test(data.mobile)) {
        errors.mobile = 'Please enter a valid 10-digit mobile number.';
      }
      if (!data.mobileVerified) {
        errors.mobile = 'Mobile number not verified via OTP.';
      }
      if (!data.email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(data.email)) {
        errors.email = 'Enter a valid email.';
      }
      if (data.emailUsed) {
        errors.email = 'Email already in use.';
      }
      if (!data.role || !roles.includes(data.role)) {
        errors.role = 'Please select a role.';
      }
      if (!data.govtIdType) {
        errors.govtIdType = 'Select a government ID type.';
      } else if (!data.govtId || !govtIdPatterns[data.govtIdType].test(data.govtId)) {
        errors.govtId = 'Invalid ID format or unmatched name.';
      }
      return { valid: Object.keys(errors).length === 0, errors };
    }

    function validateOwnershipStep(data) {
      const errors = {};
      if (!data.ownerName) {
        errors.ownerName = 'Owner name is required.';
      }
      if (!data.propertyAddress) {
        errors.propertyAddress = 'Property address is required.';
      }
      if (!data.registryNumber || !/^\d{5,20}$/.test(data.registryNumber)) {
        errors.registryNumber = 'Property ID must match registry format.';
      }
      if (!(data.govDocs && data.govDocs.length > 0)) {
        errors.govDocs = 'Please upload at least one government document.';
      }
      return { valid: Object.keys(errors).length === 0, errors };
    }

    function validateIntentStep(data) {
      const errors = {};
      if (!data.listingIntent) {
        errors.listingIntent = 'Please select listing intent.';
        return { valid: false, errors };
      }
      if (data.listingIntent === 'For Sale') {
        if (!data.expectedPrice || isNaN(data.expectedPrice) || data.expectedPrice <= 0) {
          errors.expectedPrice = 'Please enter a valid price.';
        }
      } else if (data.listingIntent === 'For Rent') {
        if (!data.monthlyRent || isNaN(data.monthlyRent) || data.monthlyRent <= 0) {
          errors.monthlyRent = 'Please enter a valid rent amount.';
        }
        if (!data.securityDeposit || isNaN(data.securityDeposit) || data.securityDeposit < 0) {
          errors.securityDeposit = 'Please enter a valid security deposit.';
        }
      } else if (data.listingIntent === 'Urgent Sale') {
        if (!data.reason || data.reason.trim().length < 3) {
          errors.reason = 'Please enter reason for urgent sale.';
        }
        if (!data.timeline) {
          errors.timeline = 'Please select timeline date.';
        }
        if (!data.minAcceptablePrice || isNaN(data.minAcceptablePrice) || data.minAcceptablePrice <= 0) {
          errors.minAcceptablePrice = 'Please enter a valid minimum price.';
        }
      }
      return { valid: Object.keys(errors).length === 0, errors };
    }

    function validateTypeStep(data) {
      const errors = {};
      if (!data.propertyType) {
        errors.propertyType = 'Please select property type.';
        return { valid: false, errors };
      }
      // Dynamic validations based on type
      if (data.propertyType === 'Apartment') {
        if (!data.bhk || isNaN(data.bhk) || data.bhk <= 0) {
          errors.bhk = 'BHK is required and must be positive.';
        }
        if (!data.builtUpArea || isNaN(data.builtUpArea) || data.builtUpArea <= 0) {
          errors.builtUpArea = 'Built-up area is required.';
        }
      } else if (data.propertyType === 'Villa') {
        if (!data.bhk || isNaN(data.bhk) || data.bhk <= 0) {
          errors.bhk = 'BHK is required and must be positive.';
        }
        if (!data.plotArea || isNaN(data.plotArea) || data.plotArea <= 0) {
          errors.plotArea = 'Plot area is required.';
        }
      } else if (data.propertyType === 'Plot') {
        if (!data.landArea || isNaN(data.landArea) || data.landArea <= 0) {
          errors.landArea = 'Land area is required.';
        }
        if (!data.surveyNumber || data.surveyNumber.trim().length < 3) {
          errors.surveyNumber = 'Survey number is required.';
        }
      } else if (data.propertyType === 'Commercial') {
        if (!data.commercialType || data.commercialType.trim().length < 2) {
          errors.commercialType = 'Commercial type is required.';
        }
        if (!data.carpetArea || isNaN(data.carpetArea) || data.carpetArea <= 0) {
          errors.carpetArea = 'Carpet area is required.';
        }
      }
      return { valid: Object.keys(errors).length === 0, errors };
    }

    function validateDetailsStep(data) {
      const errors = {};
      if (!data.location) {
        errors.location = 'Please pin a location on the map.';
      }
      if (!data.possessionStatus) {
        errors.possessionStatus = 'Select possession status.';
      }
      return { valid: Object.keys(errors).length === 0, errors };
    }

    function validateMediaStep(data) {
      const errors = {};
      if (!data.images || data.images.length < 3) {
        errors.images = 'Please upload at least three images.';
      }
      if (!data.coverImage) {
        errors.coverImage = 'Please select a cover photo.';
      }
      return { valid: Object.keys(errors).length === 0, errors };
    }

    function validateDeclarationStep(data) {
      const errors = {};
      if (!data.declarationChecked) {
        errors.declarationChecked = 'You must certify the details are genuine.';
      }
      return { valid: Object.keys(errors).length === 0, errors };
    }

    // --- FORM DATA STORAGE ---

    let wizardData = {
      // Step 1: Seller Registration
      fullName: '',
      mobile: '',
      mobileVerified: false,
      email: '',
      emailUsed: false,
      role: '',
      residentialAddress: '',
      govtIdType: '',
      govtId: '',

      // Step 2: Ownership
      ownerName: '',
      propertyAddress: '',
      registryNumber: '',
      ownershipType: '',
      govDocs: [],
      utilityBill: null,
      digitalSignature: null,

      // Step 3: Listing Intent
      listingIntent: '',
      expectedPrice: null,
      negotiable: false,
      loanEncumbrance: '',

      monthlyRent: null,
      securityDeposit: null,
      tenure: '',
      maintenanceAmount: null,
      tenantType: '',

      urgentReason: '',
      urgentTimeline: '',
      minAcceptablePrice: null,

      titleDeed: null,

      // Step 4: Property Type
      propertyType: '',
      // Apartment fields
      apartmentSociety: '',
      bhk: null,
      balconies: null,
      builtUpArea: null,
      carpetArea: null,
      floor: '',
      facing: '',
      furnishing: '',
      age: null,
      amenities: [],

      // Villa fields
      plotArea: null,
      gardenSize: null,
      floors: null,
      parking: null,
      constructionType: '',

      // Plot fields
      landArea: null,
      surveyNumber: '',
      conversionStatus: '',
      roadWidth: null,

      // Commercial fields
      commercialType: '',
      commercialCarpetArea: null,
      commercialFloors: null,
      commercialParkingRatio: null,
      fireSafety: '',

      // Step 5: General Details
      location: '',
      nearbyLandmarks: '',
      maintenance: [],
      possessionStatus: '',

      // Step 6: Media & Highlights
      images: [],
      coverImage: null,
      video: null,
      highlights: '',

      // Step 7: Declaration
      declarationChecked: false,

      // Step 8: Publish
      enableBidding: false,
      enablePrimeSale: false,
    };

    // --- UI Rendering Functions ---

    // Helpers for inputs creation
    function makeInput({ type = 'text', id, value = '', placeholder = '', disabled = false, ariaLabel, attr = '' }) {
      const dis = disabled ? 'disabled' : '';
      const aria = ariaLabel ? `aria-label="${ariaLabel}"` : '';
      return `<input type="${type}" id="${id}" name="${id}" value="${value}" placeholder="${placeholder}" ${dis} ${aria} ${attr} />`;
    }
    function makeSelect({ id, options, value = '', ariaLabel, disabled = false }) {
      const dis = disabled ? 'disabled' : '';
      let opts = options
        .map((opt) => {
          const val = typeof opt === 'object' ? opt.value : opt;
          const txt = typeof opt === 'object' ? opt.label : opt;
          const selected = val === value ? 'selected' : '';
          return `<option value="${val}" ${selected}>${txt}</option>`;
        })
        .join('\n');
      const aria = ariaLabel ? `aria-label="${ariaLabel}"` : '';
      return `<select id="${id}" name="${id}" ${dis} ${aria}>${opts}</select>`;
    }
    function makeCheckbox({ id, label, checked = false, ariaLabel, disabled = false }) {
      const dis = disabled ? 'disabled' : '';
      const check = checked ? 'checked' : '';
      const aria = ariaLabel ? `aria-label="${ariaLabel}"` : '';
      return `<label><input type="checkbox" id="${id}" name="${id}" ${check} ${dis} ${aria}/> ${label}</label>`;
    }
    function makeRadioGroup({ id, name, options, selectedValue = '', ariaLabel }) {
      let radios = options
        .map(
          (opt, idx) =>
            `<label><input type="radio" id="${id}_${idx}" name="${name}" value="${
              opt.value
            }" ${opt.value === selectedValue ? 'checked' : ''} /> ${opt.label}</label>`
        )
        .join('\n');
      return `<fieldset aria-label="${ariaLabel}">${radios}</fieldset>`;
    }

    // Render each step HTML
    function renderStep(step) {
      wizardContent.innerHTML = '';
      stepSuccessBanner.style.display = 'none';
      switch (step) {
        case 0:
          renderSellerStep();
          break;
        case 1:
          renderOwnershipStep();
          break;
        case 2:
          renderIntentStep();
          break;
        case 3:
          renderPropertyTypeStep();
          break;
        case 4:
          renderDetailsStep();
          break;
        case 5:
          renderMediaStep();
          break;
        case 6:
          renderDeclarationStep();
          break;
        case 7:
          renderPublishStep();
          break;
      }
      setupAutosaveForStep();
    }

    // Step 0: Seller Registration
    function renderSellerStep() {
      const data = wizardData;
      wizardContent.innerHTML = `
      <form id="form-seller" novalidate>
        <fieldset>
          <legend>Seller Registration</legend>
          <div class="form-group">
            <label for="fullName">Full Name *</label>
            ${makeInput({ id: 'fullName', value: data.fullName, placeholder: 'Your legal full name' })}
            <div id="error-fullName" class="error-text" aria-live="polite"></div>
          </div>

          <div class="form-group relative">
            <label for="mobile">Mobile Number * <span class="small-label">(10 digits, OTP required)</span></label>
            ${makeInput({ id: 'mobile', value: data.mobile, placeholder: 'Enter mobile number', type: 'tel', ariaLabel: 'Mobile Number' })}
            <button type="button" id="btnSendOtp" class="btn btn-outline" style="margin-top:6px;">Send OTP</button>
            <div id="otpSection" style="margin-top:8px; display:none;">
              <input type="text" id="otpInput" maxlength="6" placeholder="Enter OTP" aria-label="Enter OTP" />
              <button type="button" id="btnVerifyOtp" class="btn btn-primary" disabled>Verify OTP</button>
              <span id="otpStatus" class="success-text" style="display:none;">Verified ✓</span>
              <span id="otpError" class="error-text" style="display:none;"></span>
            </div>
            <div id="error-mobile" class="error-text" aria-live="polite"></div>
          </div>

          <div class="form-group">
            <label for="email">Email *</label>
            ${makeInput({ id: 'email', value: data.email, placeholder: 'Enter valid email', type: 'email' })}
            <div id="error-email" class="error-text" aria-live="polite"></div>
          </div>

          <div class="form-group">
            <label for="role">Role *</label>
            ${makeSelect({
              id: 'role',
              options: roles,
              value: data.role,
              ariaLabel: 'Select Role',
            })}
            <div id="error-role" class="error-text" aria-live="polite"></div>
          </div>

          <div class="form-group">
            <label for="residentialAddress">Residential Address (Optional)</label>
            <textarea id="residentialAddress" name="residentialAddress" placeholder="Your current residential address" rows="3">${data.residentialAddress}</textarea>
          </div>

          <div class="form-group relative">
            <label for="govtIdType">Identity Proof *</label>
            ${makeSelect({
              id: 'govtIdType',
              options: ['Aadhaar', 'PAN', 'Passport', 'Voter ID'],
              value: data.govtIdType,
              ariaLabel: 'Select Government ID Type',
            })}
            <span class="tooltip-icon" tabindex="0" role="tooltip" aria-label="Accepted IDs: Aadhaar, PAN, Passport, Voter ID">ℹ️
              <span class="tooltip-text">Accepted IDs: Aadhaar, PAN, Passport, Voter ID.</span>
            </span>
            <div id="error-govtIdType" class="error-text" aria-live="polite"></div>
          </div>

          <div class="form-group">
            <label for="govtId">Government ID Number *</label>
            ${makeInput({ id: 'govtId', value: data.govtId, placeholder: 'Enter government ID number' })}
            <div id="error-govtId" class="error-text" aria-live="polite"></div>
          </div>
        </fieldset>
      </form>
      `;
      setupSellerStepEventListeners();
    }

    // OTP Verification Handlers for Seller Step
    function setupSellerStepEventListeners() {
      const btnSendOtp = document.getElementById('btnSendOtp');
      const otpSection = document.getElementById('otpSection');
      const btnVerifyOtp = document.getElementById('btnVerifyOtp');
      const otpInput = document.getElementById('otpInput');
      const otpStatus = document.getElementById('otpStatus');
      const otpError = document.getElementById('otpError');
      const mobileInput = document.getElementById('mobile');

      btnSendOtp.onclick = () => {
        const mobileVal = mobileInput.value.trim();
        if (!/^\d{10}$/.test(mobileVal)) {
          showError('mobile', 'Please enter a valid 10-digit mobile number before sending OTP.');
          return;
        }
        showError('mobile', '');
        otpSection.style.display = 'block';
        otpInput.value = '';
        btnVerifyOtp.disabled = true;
        otpStatus.style.display = 'none';
        otpError.style.display = 'none';
      };

      otpInput.oninput = () => {
        const val = otpInput.value.trim();
        btnVerifyOtp.disabled = val.length !== 6 || !/^\d{6}$/.test(val);
      };

      btnVerifyOtp.onclick = () => {
        btnVerifyOtp.disabled = true;
        otpError.style.display = 'none';
        otpStatus.style.display = 'none';
        // Show spinner near verify button
        const spinner = document.createElement('span');
        spinner.className = 'inline-spinner';
        btnVerifyOtp.after(spinner);
        // Fake verification delay
        setTimeout(() => {
          spinner.remove();
          // For demo: 90% chance success, 10% failure
          if (Math.random() > 0.1) {
            otpStatus.style.display = 'inline';
            wizardData.mobileVerified = true;
            showToast('Mobile number verified successfully.');
            validateCurrentStep();
          } else {
            otpError.textContent = 'Invalid OTP, please retry.';
            otpError.style.display = 'block';
            wizardData.mobileVerified = false;
          }
          btnVerifyOtp.disabled = false;
        }, 1500);
      };

      // Input validation on blur
      ['fullName', 'mobile', 'email', 'role', 'govtIdType', 'govtId'].forEach((id) => {
        const input = document.getElementById(id);
        input.addEventListener('blur', validateCurrentStep);
      });
      // For email existence demo, simulate "email already in use"
      document.getElementById('email').addEventListener('blur', (e) => {
        const val = e.target.value.trim();
        // Fake used email for demo
        wizardData.emailUsed = val.toLowerCase() === 'test@used.com';
        validateCurrentStep();
      });
    }

    // Step 1: Ownership Verification
    function renderOwnershipStep() {
      const data = wizardData;
      const govDocNames = data.govDocs.map((f) => f.name).join(', ');
      const utilityName = data.utilityBill ? data.utilityBill.name : '';
      const signName = data.digitalSignature ? data.digitalSignature.name : '';
      wizardContent.innerHTML = `
      <form id="form-ownership" novalidate>
        <fieldset>
          <legend>Ownership Verification</legend>

          <div class="form-group">
            <label for="ownerName">Owner Name *</label>
            ${makeInput({ id: 'ownerName', value: data.ownerName, placeholder: 'Owner name on documents' })}
            <div id="error-ownerName" class="error-text" aria-live="polite"></div>
          </div>

          <div class="form-group">
            <label for="propertyAddress">Property Address *</label>
            <textarea id="propertyAddress" rows="3" placeholder="Full property address">${data.propertyAddress}</textarea>
            <div id="error-propertyAddress" class="error-text" aria-live="polite"></div>
          </div>

          <div class="form-group">
            <label for="registryNumber">Property ID / Registry No.*</label>
            ${makeInput({ id: 'registryNumber', value: data.registryNumber, placeholder: 'Numeric registry number' })}
            <div id="error-registryNumber" class="error-text" aria-live="polite"></div>
          </div>

          <div class="form-group">
            <label>Ownership Type *</label>
            ${makeRadioGroup({
              id: 'ownershipType',
              name: 'ownershipType',
              options: [
                { label: 'Single', value: 'Single' },
                { label: 'Joint', value: 'Joint' },
                { label: 'Company', value: 'Company' },
              ],
              selectedValue: data.ownershipType || '',
              ariaLabel: 'Select ownership type',
            })}
            <div id="error-ownershipType" class="error-text" aria-live="polite"></div>
          </div>

          <div class="form-group">
            <label for="govDocs">Government Documents (Sale Deed, Khata, Tax Receipt) *</label>
            <input type="file" id="govDocs" multiple accept=".pdf,image/jpeg,image/png" aria-describedby="govDocsNote" />
            <span id="govDocsNote" class="file-note">Allowed types: PDF, JPG, PNG. Max size per file 5MB.</span>
            <div class="file-list" id="govDocsList">${govDocNames ? govDocNames : ''}</div>
            <div id="error-govDocs" class="error-text" aria-live="polite"></div>
          </div>

          <div class="form-group">
            <label for="utilityBill">Utility Bill (Optional)</label>
            <input type="file" id="utilityBill" accept=".pdf,image/jpeg,image/png" aria-describedby="utilityNote" />
            <span id="utilityNote" class="file-note">Allowed types: PDF, JPG, PNG. Max size 5MB.</span>
            <div class="file-list" id="utilityList">${utilityName}</div>
          </div>

          <div class="form-group">
            <label for="digitalSignature">Digital Signature (Optional)</label>
            <input type="file" id="digitalSignature" accept=".pdf,image/jpeg,image/png" aria-describedby="signNote" />
            <span id="signNote" class="file-note">Allowed types: PDF, JPG, PNG. Max size 5MB.</span>
            <div class="file-list" id="signList">${signName}</div>
          </div>

          <button type="button" id="btnVerifyOwnership" class="btn btn-primary" aria-live="polite" aria-label="Verify Ownership Details">Verify Ownership</button>
          <span id="ownershipVerifySpinner" class="inline-spinner" style="display:none;"></span>
          <span id="ownershipVerifySuccess" class="success
-text" style="display:none; margin-left:8px;">Ownership verified ✓</span>
          <span id="ownershipVerifyError" class="error-text" style="display:none; margin-left:8px;"></span>
        </fieldset>
      </form>
      `;
      setupOwnershipStepEventListeners();
    }

    function setupOwnershipStepEventListeners() {
      const govDocsInput = document.getElementById('govDocs');
      const utilityInput = document.getElementById('utilityBill');
      const signatureInput = document.getElementById('digitalSignature');

      const govDocsList = document.getElementById('govDocsList');
      const utilityList = document.getElementById('utilityList');
      const signList = document.getElementById('signList');

      const btnVerifyOwnership = document.getElementById('btnVerifyOwnership');
      const spinner = document.getElementById('ownershipVerifySpinner');
      const successMsg = document.getElementById('ownershipVerifySuccess');
      const errorMsg = document.getElementById('ownershipVerifyError');

      govDocsInput.onchange = (e) => {
        wizardData.govDocs = Array.from(e.target.files);
        govDocsList.textContent = wizardData.govDocs.map(f => f.name).join(', ');
        validateCurrentStep();
      };
      utilityInput.onchange = (e) => {
        wizardData.utilityBill = e.target.files[0] || null;
        utilityList.textContent = wizardData.utilityBill ? wizardData.utilityBill.name : '';
      };
      signatureInput.onchange = (e) => {
        wizardData.digitalSignature = e.target.files[0] || null;
        signList.textContent = wizardData.digitalSignature ? wizardData.digitalSignature.name : '';
      };

      btnVerifyOwnership.onclick = () => {
        // Validate first before fake verify
        const formData = gatherOwnershipData();
        const validationResult = validateOwnershipStep(formData);
        displayErrors(validationResult.errors);
        if (!validationResult.valid) return;

        // Show spinner
        spinner.style.display = 'inline-block';
        btnVerifyOwnership.disabled = true;
        successMsg.style.display = 'none';
        errorMsg.style.display = 'none';

        // Fake verification delay
        setTimeout(() => {
          spinner.style.display = 'none';
          // Always success for demo
          successMsg.style.display = 'inline';
          showToast('Ownership verified successfully.');
          btnVerifyOwnership.disabled = false;

          // Mark ownership as verified in data (for demo)
          wizardData.ownershipVerified = true;
          validateCurrentStep();
        }, 1500);
      };

      // Form field changes to update wizard data & validate
      ['ownerName', 'propertyAddress', 'registryNumber'].forEach(id => {
        const input = document.getElementById(id);
        input.oninput = () => {
          wizardData[id] = input.value.trim();
          validateCurrentStep();
        };
      });
      // Radio for ownershipType
      const radioButtons = document.querySelectorAll('input[name="ownershipType"]');
      radioButtons.forEach(radio => {
        radio.onchange = () => {
          wizardData.ownershipType = document.querySelector('input[name="ownershipType"]:checked')?.value || '';
          validateCurrentStep();
        };
      });
    }

    function gatherOwnershipData() {
      return {
        ownerName: document.getElementById('ownerName').value.trim(),
        propertyAddress: document.getElementById('propertyAddress').value.trim(),
        registryNumber: document.getElementById('registryNumber').value.trim(),
        ownershipType: document.querySelector('input[name="ownershipType"]:checked')?.value || '',
        govDocs: wizardData.govDocs,
      };
    }

    // Step 2: Listing Intent
    function renderIntentStep() {
      const data = wizardData;
      wizardContent.innerHTML = `
      <form id="form-intent" novalidate>
        <fieldset>
          <legend>Listing Intent</legend>
          <div class="form-group">
            <label for="listingIntent">Select Intent *</label>
            ${makeSelect({
              id: 'listingIntent',
              options: ['For Sale', 'For Rent', 'Urgent Sale'],
              value: data.listingIntent,
              ariaLabel: 'Select Listing Intent',
            })}
            <div id="error-listingIntent" class="error-text" aria-live="polite"></div>
          </div>

          <div id="intentForSaleFields" class="${data.listingIntent === 'For Sale' ? '' : 'hidden'}">
            <div class="form-group">
              <label for="expectedPrice">Expected Price *</label>
              ${makeInput({ id: 'expectedPrice', type: 'number', value: data.expectedPrice || '', placeholder: 'Enter expected price' })}
              <div id="error-expectedPrice" class="error-text" aria-live="polite"></div>
            </div>
            <div class="form-group">
              <label>${makeCheckbox({ id: 'negotiable', label: 'Negotiable', checked: data.negotiable })}</label>
            </div>
            <div class="form-group">
              <label for="loanEncumbrance">Loan / Encumbrance</label>
              ${makeSelect({
                id: 'loanEncumbrance',
                options: ['None', 'Loan', 'Encumbrance'],
                value: data.loanEncumbrance || 'None',
                ariaLabel: 'Select Loan or Encumbrance',
              })}
            </div>
            <div class="form-group">
              <label for="titleDeed">Title Deed Upload</label>
              <input type="file" id="titleDeed" accept=".pdf,.jpg,.jpeg,.png" />
            </div>
          </div>

          <div id="intentForRentFields" class="${data.listingIntent === 'For Rent' ? '' : 'hidden'}">
            <div class="form-group">
              <label for="monthlyRent">Monthly Rent *</label>
              ${makeInput({ id: 'monthlyRent', type: 'number', value: data.monthlyRent || '', placeholder: 'Enter monthly rent' })}
              <div id="error-monthlyRent" class="error-text" aria-live="polite"></div>
            </div>
            <div class="form-group">
              <label for="securityDeposit">Security Deposit *</label>
              ${makeInput({ id: 'securityDeposit', type: 'number', value: data.securityDeposit || '', placeholder: 'Enter security deposit' })}
              <div id="error-securityDeposit" class="error-text" aria-live="polite"></div>
            </div>
            <div class="form-group">
              <label for="tenure">Tenure *</label>
              ${makeSelect({
                id: 'tenure',
                options: ['6 Months', '1 Year', '2 Years', '3+ Years'],
                value: data.tenure,
                ariaLabel: 'Select Tenure',
              })}
            </div>
            <div class="form-group">
              <label for="maintenanceAmount">Maintenance Amount (Optional)</label>
              ${makeInput({ id: 'maintenanceAmount', type: 'number', value: data.maintenanceAmount || '', placeholder: 'Enter maintenance amount' })}
            </div>
            <div class="form-group">
              <label for="tenantType">Tenant Type</label>
              ${makeSelect({
                id: 'tenantType',
                options: ['Family', 'Professionals', 'Students'],
                value: data.tenantType,
                ariaLabel: 'Select Tenant Type',
              })}
            </div>
          </div>

          <div id="intentUrgentSaleFields" class="${data.listingIntent === 'Urgent Sale' ? '' : 'hidden'}">
            <div class="form-group">
              <label for="urgentReason">Reason *</label>
              ${makeInput({ id: 'urgentReason', value: data.urgentReason, placeholder: 'Reason for urgent sale' })}
              <div id="error-urgentReason" class="error-text" aria-live="polite"></div>
            </div>
            <div class="form-group">
              <label for="urgentTimeline">Timeline *</label>
              <input type="date" id="urgentTimeline" name="urgentTimeline" value="${
                data.urgentTimeline ? parseDateToYYYYMMDD(data.urgentTimeline) : ''
              }" aria-label="Select timeline" />
              <div id="error-urgentTimeline" class="error-text" aria-live="polite"></div>
            </div>
            <div class="form-group">
              <label for="minAcceptablePrice">Minimum Acceptable Price *</label>
              ${makeInput({ id: 'minAcceptablePrice', type: 'number', value: data.minAcceptablePrice || '', placeholder: 'Enter minimum price' })}
              <div id="error-minAcceptablePrice" class="error-text" aria-live="polite"></div>
            </div>
          </div>
        </fieldset>
      </form>
      `;

      // Show/hide conditional blocks on change
      const listingIntentSelect = document.getElementById('listingIntent');
      listingIntentSelect.onchange = () => {
        wizardData.listingIntent = listingIntentSelect.value;
        // Reset step fields for intent conditionals
        wizardData.expectedPrice = null;
        wizardData.negotiable = false;
        wizardData.loanEncumbrance = 'None';
        wizardData.monthlyRent = null;
        wizardData.securityDeposit = null;
        wizardData.tenure = '';
        wizardData.maintenanceAmount = null;
        wizardData.tenantType = '';
        wizardData.urgentReason = '';
        wizardData.urgentTimeline = '';
        wizardData.minAcceptablePrice = null;
        renderStep(currentStep); // re-render to update input visibility
      };
      setupIntentStepEventListeners();
    }

    function setupIntentStepEventListeners() {
      const inputs = wizardContent.querySelectorAll('input, select');
      inputs.forEach((input) => {
        input.addEventListener('input', (e) => {
          const id = e.target.id;
          const val = e.target.type === 'checkbox' ? e.target.checked : e.target.value;
          wizardData[id] = val;
          validateCurrentStep();
        });
      });
      // Checkbox negotiable specifically requires event
      const negotiableCheckbox = document.getElementById('negotiable');
      if (negotiableCheckbox) {
        negotiableCheckbox.addEventListener('change', (e) => {
          wizardData.negotiable = e.target.checked;
          validateCurrentStep();
        });
      }
      // Date input for urgentTimeline
      const urgentTimelineInput = document.getElementById('urgentTimeline');
      if (urgentTimelineInput) {
        urgentTimelineInput.addEventListener('change', (e) => {
          wizardData.urgentTimeline = e.target.value;
          validateCurrentStep();
        });
      }
    }

    // Additional steps (Property Type, Details, Media, Declaration, Publish) 
    // would follow similarly with validations, dynamic fields and controls,
    // autosave hooks, and fake verifications as outlined in the request.

    // Due to character limit, I can continue the full final step code as needed.

    // ----------- COMMON FUNCTIONS -----------

    function showError(fieldId, message) {
      const el = document.getElementById(`error-${fieldId}`);
      if (el) el.textContent = message;
    }

    function clearErrors() {
      const errorDivs = wizardContent.querySelectorAll('.error-text');
      errorDivs.forEach(div => div.textContent = '');
    }

    function displayErrors(errors) {
      clearErrors();
      Object.entries(errors).forEach(([field, msg]) => {
        showError(field, msg);
      });
    }

    function validateCurrentStep() {
      clearErrors();
      let validationResult = { valid: false, errors: {} };
      let formData = {};

      switch (currentStep) {
        case 0:
          formData = {
            fullName: document.getElementById('fullName')?.value.trim() || '',
            mobile: document.getElementById('mobile')?.value.trim() || '',
            mobileVerified: wizardData.mobileVerified,
            email: document.getElementById('email')?.value.trim() || '',
            emailUsed: wizardData.emailUsed,
            role: document.getElementById('role')?.value || '',
            govtIdType: document.getElementById('govtIdType')?.value || '',
            govtId: document.getElementById('govtId')?.value.trim() || '',
          };
          validationResult = validateSellerStep(formData);
          break;
        case 1:
          formData = gatherOwnershipData();
          validationResult = validateOwnershipStep(Object.assign(formData, { govDocs: wizardData.govDocs }));
          // Also require verified ownership to proceed
          if (!wizardData.ownershipVerified) {
            validationResult.valid = false;
            validationResult.errors.ownershipVerify = "Ownership must be verified.";
            showError('ownershipVerify', "Ownership must be verified by clicking 'Verify Ownership'.");
          }
          break;
        case 2:
          formData = {
            listingIntent: document.getElementById('listingIntent')?.value || '',
            expectedPrice: Number(document.getElementById('expectedPrice')?.value) || null,
            negotiable: wizardData.negotiable,
            loanEncumbrance: document.getElementById('loanEncumbrance')?.value || 'None',
            monthlyRent: Number(document.getElementById('monthlyRent')?.value) || null,
            securityDeposit: Number(document.getElementById('securityDeposit')?.value) || null,
            tenure: document.getElementById('tenure')?.value || '',
            maintenanceAmount: Number(document.getElementById('maintenanceAmount')?.value) || null,
            tenantType: document.getElementById('tenantType')?.value || '',
            urgentReason: document.getElementById('urgentReason')?.value.trim() || '',
            urgentTimeline: document.getElementById('urgentTimeline')?.value || '',
            minAcceptablePrice: Number(document.getElementById('minAcceptablePrice')?.value) || null,
          };
          validationResult = validateIntentStep(formData);
          break;
        // Additional steps validation will be similarly handled...
        default:
          validationResult = { valid: true, errors: {} };
          break;
      }

      displayErrors(validationResult.errors);
      document.getElementById('btnNext').disabled = !validationResult.valid;
      return validationResult.valid;
    }

    function updateControlButtons() {
      // Show/enable/disable buttons based on step
      const btnBack = document.getElementById('btnBack');
      const btnNext = document.getElementById('btnNext');

      btnBack.disabled = currentStep === 0;
      btnNext.textContent = currentStep === steps.length - 1 ? 'Publish' : 'Next';

      // Initial validation check to enable/disable Next
      validateCurrentStep();
    }

    function focusFirstInputInStep() {
      // Focus first input or select in current step content
      const firstInput = wizardContent.querySelector('input, select, textarea, button:not([disabled])');
      if (firstInput) firstInput.focus();
    }

    // --- WIZARD EVENTS ---
    document.getElementById('btnNext').addEventListener('click', () => {
      if (!validateCurrentStep()) return;
      if (currentStep === steps.length - 1) {
        // Publish step: finalize and add property
        publishProperty();
      } else {
        currentStep += 1;
        navigateToStep(currentStep);
      }
    });

    document.getElementById('btnBack').addEventListener('click', () => {
      if (currentStep > 0) {
        currentStep -= 1;
        navigateToStep(currentStep);
      }
    });

    document.getElementById('btnSaveDraft').addEventListener('click', () => {
      autosaveDraft();
      showToast('Draft saved');
    });

    document.getElementById('wizardCloseBtn').addEventListener('click', () => {
      if (confirm('Are you sure you want to close? Unsaved changes may be lost.')) {
        closeWizard();
      }
    });

    // Open wizard
    document.getElementById('btnAddProperty').addEventListener('click', () => {
      openWizard();
    });

    // --- PROPERTY DASHBOARD RENDER ---
    function renderPropertyCards() {
      const cardsContainer = document.getElementById('propertyCards');
      const emptyState = document.getElementById('emptyState');
      const filterBar = document.querySelector('.filter-bar');

      cardsContainer.innerHTML = '';
      if (properties.length === 0) {
        emptyState.style.display = 'block';
        filterBar.style.display = 'none';
        return;
      } else {
        emptyState.style.display = 'none';
        filterBar.style.display = 'flex';
      }

      properties.forEach((prop) => {
        const cardDiv = document.createElement('div');
        cardDiv.className = 'property-card';
        cardDiv.setAttribute('data-id', prop.id);
        cardDiv.innerHTML = `
          <div class="property-image">
            <img src="${prop.images?.[0] || 'https://via.placeholder.com/240x160?text=No+Image'}" alt="${prop.title || 'Property Image'}" />
            <div class="property-status">${prop.listingIntent || 'For Sale'}</div>
          </div>
          <div class="property-content">
            <div class="property-header">
              <h2 class="property-title">${prop.title || 'Untitled Property'}</h2>
              <div class="property-actions">
                <button class="action-btn edit-property" aria-label="Edit ${prop.title || 'property'}"><i class="fas fa-edit"></i></button>
                <button class="action-btn more-options" aria-label="More options"><i class="fas fa-ellipsis-v"></i></button>
              </div>
            </div>
            <p class="property-address">${prop.propertyAddress || ''}</p>
            <div class="property-details">
              <span><i class="fas fa-bed"></i> ${prop.bhk || '-' } Beds</span>
              <span><i class="fas fa-bath"></i> ${prop.baths || '-' } Baths</span>
              <span><i class="fas fa-ruler-combined"></i> ${prop.builtUpArea || '-'} sq.ft.</span>
            </div>
            <div class="property-features">
              <div class="feature-tag tag-${prop.listingIntent?.toLowerCase().replace(/\s/g, '') || 'sale'}">${prop.listingIntent || 'Sale'}</div>
              <div class="feature-tag tag-active">${prop.status || 'Active'}</div>
              ${
                prop.enableBidding
                  ? `<div class="feature-tag tag-bidding" title="View Bidding" role="button" tabindex="0" aria-label="View Bidding for ${prop.title}"><i class="fas fa-gavel"></i> Bidding</div>`
                  : ''
              }
            </div>
            <div class="property-footer">
              <div class="property-price">${formatCurrency(prop.price || 0)}</div>
              <div class="property-date">Added: ${prop.addedDate || '-'}</div>
            </div>
          </div>
        `;
        cardsContainer.appendChild(cardDiv);
      });

      // Add Event Listeners for new cards
      document.querySelectorAll('.feature-tag.tag-bidding').forEach(el => {
        el.addEventListener('click', (e) => {
          const card = e.target.closest('.property-card');
          if (card) {
            openBiddingDashboard(card.getAttribute('data-id'));
          }
        });
        // Support keyboard accessibility
        el.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            e.target.click();
          }
        });
      });
    }

    // --- WIZARD OPEN/CLOSE ---

    function openWizard() {
      resetWizardData();
      currentStep = 0;
      wizardModal.style.display = 'flex';
      navigateToStep(currentStep);
      validateCurrentStep();
      // Focus modal for screen readers
      wizardModal.focus();
    }

    function closeWizard() {
      wizardModal.style.display = 'none';
      // Clear wizard content for next open?
      wizardContent.innerHTML = '';
      stepSuccessBanner.style.display = 'none';
      editingPropertyId = null;
      wizardData.mobileVerified = false;
      wizardData.ownershipVerified = false;
    }

    // --- PUBLISHING THE PROPERTY ---

    function publishProperty() {
      // Collect all data from wizardData to "publish"
      // For demo, create new property object and append to properties.

      // Minimal simulated fields for card:
      const newProperty = {
        id: Date.now().toString(),
        title: wizardData.fullName + "'s Property",
        propertyAddress: wizardData.propertyAddress || 'Not specified',
        bhk: wizardData.bhk || 3,
        baths: 2,
        builtUpArea: wizardData.builtUpArea || 1200,
        price:
          wizardData.listingIntent === 'For Sale'
            ? wizardData.expectedPrice || 0
            : wizardData.listingIntent === 'For Rent'
            ? wizardData.monthlyRent || 0
            : 0,
        listingIntent: wizardData.listingIntent || 'For Sale',
        status: 'Active',
        images: wizardData.images.map(f => URL.createObjectURL(f)),
        addedDate: new Date().toLocaleDateString('en-IN', { year: 'numeric', month: 'short', day: 'numeric' }),
        enableBidding: wizardData.enableBidding || false,
      };
      properties.push(newProperty);
      showToast('Property published successfully!');
      closeWizard();
      renderPropertyCards();
    }

    // --- BIDDING DASHBOARD ---

    const biddingDashboard = document.getElementById('biddingDashboard');
    let biddingProperty = null;
    let biddingTimer = null;
    let biddingCountdown = 600; // 10 minutes demo
    let biddingEnded = false;
    const bidsSection = document.getElementById('bidsSection');
    const seeMoreBtn = document.getElementById('seeMoreBtn');
    const sortSelect = document.getElementById('sortSelect');
    const bidCount = document.getElementById('bidCount');
    const highestBidMeta = document.getElementById('highestBidMeta');
    const timerElement = document.getElementById('timerElement');
    const timerWarning = document.getElementById('timerWarning');
    const biddingOverOverlay = document.getElementById('biddingOverOverlay');
    const notedBtn = document.getElementById('notedBtn');

    let visibleCount = 5;
    let currentSort = 'amount-desc';
    let bids = [];

    function openBiddingDashboard(propertyId) {
      biddingProperty = properties.find(p => p.id === propertyId);
      if (!biddingProperty) return;
      // Hide main dashboard
      document.getElementById('propertyDashboard').style.display = 'none';
      biddingDashboard.style.display = 'block';

      // Populate bidding header
      document.getElementById('biddingPropertyName').textContent = biddingProperty.title;
      document.getElementById('biddingPropertyLocation').textContent = biddingProperty.propertyAddress;
      document.getElementById('biddingPropertyImage').src = biddingProperty.images[0] || '';
      document.getElementById('biddingStatus').textContent = biddingProperty.listingIntent;
      document.getElementById('biddingBeds').textContent = `${biddingProperty.bhk} Beds`;
      document.getElementById('biddingBaths').textContent = `${biddingProperty.baths} Baths`;
      document.getElementById('biddingArea').textContent = `${biddingProperty.builtUpArea} sq.ft.`;

      // Reset & load demo bids
      bids = JSON.parse(JSON.stringify(sampleBidsTemplate));
      visibleCount = 5;
      biddingEnded = false;
      timerWarning.style.display = 'none';
      biddingOverOverlay.style.display = 'none';
      countdownSeconds = 600; // 10 mins
      updateMeta();
      sortBids();
      updateTimer();

      if (biddingTimer) clearInterval(biddingTimer);
      biddingTimer = setInterval(updateTimer, 1000);
    }

    function closeBiddingDashboard() {
      biddingDashboard.style.display = 'none';
      document.getElementById('propertyDashboard').style.display = 'block';
      if (biddingTimer) {
        clearInterval(biddingTimer);
        biddingTimer = null;
      }
    }

    // Timer logic
    let countdownSeconds = 600;
    function updateTimer() {
      if (biddingEnded) return;

      if (countdownSeconds > 0) {
        const hrs = String(Math.floor(countdownSeconds / 3600)).padStart(2, '0');
        const mins = String(Math.floor((countdownSeconds % 3600) / 60)).padStart(2, '0');
        const secs = String(countdownSeconds % 60).padStart(2, '0');
        timerElement.textContent = `${hrs}:${mins}:${secs}`;

        if (countdownSeconds <= 300) {
          timerElement.classList.add('pulse');
          timerWarning.style.display = 'block';
        }

        countdownSeconds--;
      } else {
        endBidding();
      }
    }

    function endBidding() {
      biddingEnded = true;
      timerElement.textContent = 'Bidding Closed';
      timerWarning.style.display = 'none';
      seeMoreBtn.disabled = true;
      sortSelect.disabled = true;
      biddingOverOverlay.style.display = 'flex';
      clearInterval(biddingTimer);
    }

    function updateMeta() {
      if (bids.length === 0) {
        highestBidMeta.textContent = '—';
        bidCount.textContent = '(0)';
        return;
      }
      const highest = Math.max(...bids.map(b => b.amount));
      highestBidMeta.textContent = formatCurrency(highest);
      bidCount.textContent = `(${bids.length})`;
    }

    function sortBids() {
      switch (currentSort) {
        case 'amount-desc':
          bids.sort((a, b) => b.amount - a.amount);
          break;
        case 'amount-asc':
          bids.sort((a, b) => a.amount - b.amount);
          break;
        case 'date-desc':
          bids.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
          break;
        case 'date-asc':
          bids.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
          break;
        case 'deposit-desc':
          bids.sort((a, b) => b.deposit - a.deposit);
          break;
        case 'deposit-asc':
          bids.sort((a, b) => a.deposit - b.deposit);
          break;
      }
      renderBids();
    }

    function renderBids() {
      const highest = bids.length ? Math.max(...bids.map(b => b.amount)) : 0;
      bidsSection.innerHTML = '';
      const toRender = bids.slice(0, Math.min(visibleCount, bids.length));
      toRender.forEach((bid) => {
        const row = document.createElement('div');
        row.className = `bid-row grid${bid.amount === highest ? ' highlight' : ''}`;
        row.setAttribute('role', 'listitem');
        const isTop = bid.amount === highest;
        row.innerHTML = `
          <div class="top-flag" title="${isTop ? 'Highest bid' : ''}">${isTop ? '<i class="fas fa-trophy" aria-label="Highest bid"></i>' : ''}</div>
          <div class="bidder-name">${bid.bidderName}</div>
          <div class="deposit-amount">${formatCurrency(bid.deposit)}</div>
          <div class="bid-amount">${formatCurrency(bid.amount)}</div>
          <time class="bid-timestamp" datetime="${bid.timestamp}">${formatTimestamp(bid.timestamp)}</time>
          <div class="action-col">
            <button class="profile-button" aria-label="View profile of ${bid.bidderName}" data-bidder='${JSON.stringify(bid)}'>View Profile</button>
          </div>
        `;
        bidsSection.appendChild(row);
      });

      seeMoreBtn.style.display = visibleCount >= bids.length ? 'none' : 'flex';
      updateMeta();
    }

    seeMoreBtn.addEventListener('click', () => {
      visibleCount += 5;
      renderBids();
      showToast('Loaded more bids');
    });

    sortSelect.addEventListener('change', (e) => {
      currentSort = e.target.value;
      sortBids();
      showToast('Sorted bids');
      bidsSection.scrollTop = 0;
    });

    // Profile modal
    const profileModal = document.getElementById('profileModal');
    const profileBody = document.getElementById('profileBody');
    const closeModalBtn = document.getElementById('closeModal');
    bidsSection.addEventListener('click', (e) => {
      if (e.target.classList.contains('profile-button')) {
        const bidder = JSON.parse(e.target.dataset.bidder);
        openProfileModal(bidder);
      }
    });
    closeModalBtn.addEventListener('click', () => {
      profileModal.style.display = 'none';
    });
    profileModal.addEventListener('click', (e) => {
      if (e.target === profileModal) {
        profileModal.style.display = 'none';
      }
    });

    function openProfileModal(bidder) {
      profileBody.innerHTML = `
        <div><strong>Name:</strong> ${bidder.bidderName}</div>
        <div><strong>Email:</strong> ${bidder.email}</div>
        <div><strong>Deposited Amount:</strong> ${formatCurrency(bidder.deposit)}</div>
        <div><strong>Latest Bid:</strong> ${formatCurrency(bidder.amount)}</div>
        <div><strong>Bid Time:</strong> ${formatTimestamp(bidder.timestamp)}</div>
        <div style="margin-top:10px;">
          <a href="${bidder.profile}" target="_blank" rel="noopener" class="profile-button" style="text-decoration:none;">
            <i class="fas fa-external-link-alt"></i> Open Full Profile
          </a>
        </div>
      `;
      profileModal.style.display = 'flex';
    }

    // Bidding ended overlay
    const notedBtnElem = document.getElementById('notedBtn');
    notedBtnElem.addEventListener('click', () => {
      biddingOverOverlay.style.display = 'none';
      showToast('Bidding close acknowledged');
    });

    // Initialization
    renderPropertyCards();
    closeWizard();
    closeBiddingDashboard();
  })();
</script>
</body>
</html>
